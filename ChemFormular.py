#!/usr/bin/python

#
# Error code
#
NOELEMENT = -1
INVALIDFORMULAR = -2

IMASS = 0
ICHARGE = 1
IKAI = 2
ICOVR = 3
IIONR = 4
IATMR = 5
#
# Reference: 
# mass: http://ours.be/sci/aw.php
# electronegativity: http://cec.ecust.edu.cn/jpkc/lessons/chemPage/element1.htm       
# atomic radius: http://cec.ecust.edu.cn/jpkc/lessons/chemPage/element1.htm       
# ionic radius(pm): http://cec.ecust.edu.cn/jpkc/lessons/chemPage/element2.htm
# single covalent radius(pm): http://cec.ecust.edu.cn/jpkc/lessons/chemPage/element3.htm
#
AtomList = {
#              IMASS       ICHARGE   IKAI      ICOVR      IIONR        IATMR
    'H':   (   1.00794     ,  1   ,  2.2   ,   32      ,  '1.2(+1)   ',   79       ),
    'He':  (   4.002602    ,  2   ,  'N/A' ,   93      ,  'N/A       ',   49       ),
    'Li':  (   6.941       ,  3   ,  0.98  ,   123     ,  '76(+1)    ',   205      ),
    'Be':  (   9.012182    ,  4   ,  1.57  ,   90      ,  '35(+2)    ',   140      ),
    'B':   (  10.811       ,  5   ,  2.04  ,   82      ,  '23(+3)    ',   117      ),
    'C':   (  12.0107      ,  6   ,  2.55  ,   77      ,  '16(+4)    ',   91       ),
    'N':   (  14.0067      ,  7   ,  3.04  ,   75      ,  '13(+3)    ',   75       ),
    'O':   (  15.9994      ,  8   ,  3.44  ,   73      ,  '140(-2)   ',   65       ),
    'F':   (  18.9984032   ,  9   ,  3.98  ,   72      ,  '133(-1)   ',   57       ),
    'Ne':  (  20.1797      ,  10  ,  'N/A' ,   71      ,  'N/A       ',   51       ),
    'Na':  (  22.98976928  ,  11  ,  0.93  ,   154     ,  '102(+1)   ',   223      ),
    'Mg':  (  24.3050      ,  12  ,  1.31  ,   136     ,  '72(+2)    ',   172      ),
    'Al':  (  26.9815386   ,  13  ,  1.61  ,   118     ,  '53.5(+3)  ',   182      ),
    'Si':  (  28.0855      ,  14  ,  1.9   ,   111     ,  '40(+4)    ',   146      ),
    'P':   (  30.973762    ,  15  ,  2.19  ,   106     ,  '38(+5)    ',   123      ),
    'S':   (  32.065       ,  16  ,  2.58  ,   102     ,  '37(+6)    ',   109      ),
    'Cl':  (  35.453       ,  17  ,  3.16  ,   99      ,  '181(-1)   ',   97       ),
    'Ar':  (  39.948       ,  18  ,  'N/A' ,   98      ,  'N/A       ',   88       ),
    'K':   (  39.0983      ,  19  ,  0.82  ,   203     ,  '138(+1)   ',   277      ),
    'Ca':  (  40.078       ,  20  ,  1.0   ,   174     ,  '99(+2)    ',   223      ),
    'Sc':  (  44.95591     ,  21  ,  1.36  ,   144     ,  '74.5(+3)  ',   209      ),
    'Ti':  (  47.867       ,  22  ,  1.54  ,   132     ,  '60.5(+4)  ',   200      ),
    'V':   (  50.9415      ,  23  ,  1.63  ,   122     ,  '59(+5)    ',   192      ),
    'Cr':  (  51.9961      ,  24  ,  1.66  ,   118     ,  '52(+6)    ',   185      ),
    'Mn':  (  54.938045    ,  25  ,  1.55  ,   117     ,  '46(+7)    ',   179      ),
    'Fe':  (  55.845       ,  26  ,  1.83  ,   117     ,  '64.5(+3)  ',   172      ),
    'Co':  (  58.933195    ,  27  ,  1.88  ,   116     ,  '74.5(+2)  ',   167      ),
    'Ni':  (  58.6934      ,  28  ,  1.91  ,   115     ,  '69(+2)    ',   162      ),
    'Cu':  (  63.546       ,  29  ,  1.9   ,   117     ,  '73(+2)    ',   157      ),
    'Zn':  (  65.38        ,  30  ,  1.65  ,   125     ,  '74(+2)    ',   153      ),
    'Ga':  (  69.723       ,  31  ,  1.81  ,   126     ,  '62(+3)    ',   181      ),
    'Ge':  (  72.64        ,  32  ,  2.01  ,   122     ,  '53(+4)    ',   152      ),
    'As':  (  74.92160     ,  33  ,  2.18  ,   120     ,  '58(+3)    ',   133      ),
    'Se':  (  78.96        ,  34  ,  2.55  ,   116     ,  '50(+6)    ',   255      ),
    'Br':  (  79.904       ,  35  ,  2.96  ,   114     ,  '196(-1)   ',   112      ),
    'Kr':  (  83.798       ,  36  ,  'N/A' ,   112     ,  'N/A       ',   103      ), 
    'Pb':  (  85.4678      ,  37  ,  0.82  ,   216     ,  '152(+1)   ',   298      ),
    'Sr':  (  87.62        ,  38  ,  0.95  ,   191     ,  '112(+2)   ',   245      ),
    'Y':   (  88.90585     ,  39  ,  1.22  ,   162     ,  '90(+3)    ',   227      ),
    'Zr':  (  91.224       ,  40  ,  1.33  ,   145     ,  '72(+4)    ',   216      ),
    'Nb':  (  92.90638     ,  41  ,  1.6   ,   134     ,  '69(+5)    ',   208      ),
    'Mo':  (  95.96        ,  42  ,  2.16  ,   130     ,  '65(+6)    ',   201      ),
    'Tc':  (  99.00        ,  43  ,  1.9   ,   127     ,  '56(+7)    ',   195      ),
    'Ru':  ( 101.07        ,  44  ,  2.2   ,   125     ,  '68(+4)    ',   189      ),
    'Rh':  ( 102.90550     ,  45  ,  2.28  ,   125     ,  '68(+4)    ',   183      ),
    'Pd':  ( 106.42        ,  46  ,  2.2   ,   128     ,  '86(+2)    ',   179      ),
    'Ag':  ( 107.8682      ,  47  ,  1.93  ,   134     ,  '126(+1)   ',   175      ),
    'Cd':  ( 112.411       ,  48  ,  1.69  ,   148     ,  '97(+2)    ',   171      ),
    'In':  ( 114.818       ,  49  ,  1.78  ,   144     ,  '80(+3)    ',   200      ),
    'Sn':  ( 118.710       ,  50  ,  1.96  ,   141     ,  '69(+4)    ',   172      ),
    'Sb':  ( 121.760       ,  51  ,  2.05  ,   140     ,  '76(+3)    ',   153      ),
    'Te':  ( 127.60        ,  52  ,  2.1   ,   136     ,  '97(+4)    ',   142      ),
    'I':   ( 126.90447     ,  53  ,  2.66  ,   133     ,  '220(-1)   ',   132      ),
    'Xe':  ( 131.293       ,  54  ,  0.00  ,   131     ,  'N/A       ',   124      ),
    'Cs':  ( 132.9054519   ,  55  ,  0.79  ,   235     ,  '167(+1)   ',   334      ),
    'Ba':  ( 137.327       ,  56  ,  0.89  ,   198     ,  '135(+2)   ',   278      ),
    'La':  ( 138.90547     ,  57  ,  1.1   ,   169     ,  '106.1(+3) ',   274      ),
    'Ce':  ( 140.116       ,  58  ,  1.12  ,   165     ,  '103.4(+3) ',   270      ),
    'Pr':  ( 140.90765     ,  59  ,  1.13  ,   165     ,  '101.3(+3) ',   267      ),
    'Nd':  ( 144.242       ,  60  ,  1.14  ,   164     ,  '99.5(+3)  ',   264      ),
    'Pm':  ( 145.00        ,  61  ,  1.13  ,   163     ,  '97.9(+3)  ',   262      ),
    'Sm':  ( 150.36        ,  62  ,  1.17  ,   162     ,  '96.4(+3)  ',   259      ),
    'Eu':  ( 151.964       ,  63  ,  1.2   ,   185     ,  '94.7(+3)  ',   256      ),
    'Gd':  ( 157.25        ,  64  ,  1.2   ,   161     ,  '93.8(+3)  ',   254      ),
    'Tb':  ( 158.92535     ,  65  ,  1.2   ,   159     ,  '92.3(+3)  ',   251      ),
    'Dy':  ( 162.500       ,  66  ,  1.22  ,   159     ,  '91.2(+3)  ',   249      ),
    'Ho':  ( 164.93032     ,  67  ,  1.23  ,   158     ,  '90.1(+3)  ',   247      ),
    'Er':  ( 167.259       ,  68  ,  1.24  ,   157     ,  '88.1(+3)  ',   245      ),
    'Tm':  ( 168.93421     ,  69  ,  1.25  ,   156     ,  '86.9(+3)  ',   242      ),
    'Yb':  ( 173.054       ,  70  ,  1.1   ,   174     ,  '85.8(+3)  ',   240      ),
    'Lu':  ( 174.9668      ,  71  ,  1.27  ,   156     ,  '84.8(+3)  ',   225      ),
    'Hf':  ( 178.49        ,  72  ,  1.3   ,   144     ,  '71(+4)    ',   216      ),
    'Ta':  ( 180.94788     ,  73  ,  1.5   ,   134     ,  '64(+5)    ',   209      ),
    'W':   ( 183.84        ,  74  ,  2.36  ,   130     ,  '62(+6)    ',   202      ),
    'Re':  ( 186.207       ,  75  ,  1.9   ,   128     ,  '56(+6)    ',   197      ),
    'OS':  ( 190.23        ,  76  ,  2.2   ,   126     ,  '63(+4)    ',   192      ),
    'Ir':  ( 192.217       ,  77  ,  2.2   ,   127     ,  '62.5(+4)  ',   187      ),
    'Pt':  ( 195.084       ,  78  ,  2.28  ,   130     ,  '62.5(+4)  ',   183      ),
    'Au':  ( 196.966569    ,  79  ,  2.54  ,   134     ,  '85(+3)    ',   179      ),
    'Hg':  ( 200.59        ,  80  ,  2.00  ,   149     ,  '102(+2)   ',   176      ),
    'Tl':  ( 204.3833      ,  81  ,  2.04  ,   148     ,  '150(+1)   ',   208      ),
    'Pb':  ( 207.2         ,  82  ,  2.33  ,   147     ,  '119(+2)   ',   181      ),
    'Bi':  ( 208.98040     ,  83  ,  2.02  ,   146     ,  '103(+3)   ',   163      ),
    'Po':  ( 210.00        ,  84  ,  2.00  ,   146     ,  '230(-2)   ',   153      ),
    'At':  ( 210.00        ,  85  ,  2.2   ,   145     ,  'N/A       ',   143      ),
    'Rn':  ( 222.00        ,  86  ,  0.00  ,   'N/A'   ,  'N/A       ',   134      ),
    'Fr':  ( 223.00        ,  87  ,  0.7   ,   'N/A'   ,  '180(+1)   ',   'N/A'    ),
    'Pa':  ( 226.00        ,  88  ,  0.9   ,   'N/A'   ,  '143(+2)   ',   'N/A'    ),
    'Ac':  ( 227.00        ,  89  ,  1.1   ,   'N/A'   ,  '111.9(+3) ',   'N/A'    ),
    'Th':  ( 232.03806     ,  90  ,  1.3   ,   165     ,  '97.2(+4)  ',   'N/A'    ),
    'Pa':  ( 231.03588     ,  91  ,  1.5   ,   'N/A'   ,  '78(+5)    ',   'N/A'    ),
    'U':   ( 238.02891     ,  92  ,  1.38  ,   142     ,  '52(+6)    ',   'N/A'    ),
    'Np':  ( 237.00        ,  93  ,  1.36  ,   'N/A'   ,  '75(+6)    ',   'N/A'    ),
    'Pu':  ( 239.00        ,  94  ,  1.28  ,   'N/A'   ,  '88.7(+4)  ',   'N/A'    ),
    'Am':  ( 243.00        ,  95  ,  1.3   ,   'N/A'   ,  '98.2(+3)  ',   'N/A'    ),
    'Cm':  ( 247.00        ,  96  ,  1.3   ,   'N/A'   ,  '97(+3)    ',   'N/A'    ),
    'Bk':  ( 247.00        ,  97  ,  1.3   ,   'N/A'   ,  '94.9(+3)  ',   'N/A'    ),
    'Cf':  ( 252.00        ,  98  ,  1.3   ,   'N/A'   ,  '93.4(+3)  ',   'N/A'    ),
    'Es':  ( 252.00        ,  99  ,  1.3   ,   'N/A'   ,  '92.5(+3)  ',   'N/A'    ),
    'Fm':  ( 257.00        ,  100 ,  1.3   ,   'N/A'   ,  'N/A       ',   'N/A'    ),
    'Md':  ( 256.00        ,  101 ,  1.3   ,   'N/A'   ,  'N/A       ',   'N/A'    ),
    'No':  ( 259.00        ,  102 ,  1.3   ,   'N/A'   ,  '110(+3)   ',   'N/A'    ),
    'Lr':  ( 262.00        ,  103 ,  'N/A' ,   'N/A'   ,  'N/A       ',   'N/A'    ),
    'Rf':  ( 267.00        ,  104 ,  'N/A' ,   'N/A'   ,  'N/A       ',   'N/A'    ),
    'Db':  ( 268.00        ,  105 ,  'N/A' ,   'N/A'   ,  'N/A       ',   'N/A'    ),
    'Sg':  ( 271.00        ,  106 ,  'N/A' ,   'N/A'   ,  'N/A       ',   'N/A'    ),
    'Bh':  ( 272.00        ,  107 ,  'N/A' ,   'N/A'   ,  'N/A       ',   'N/A'    ),
    'Hs':  ( 277.00        ,  108 ,  'N/A' ,   'N/A'   ,  'N/A       ',   'N/A'    ),
    'Mt':  ( 276.00        ,  109 ,  'N/A' ,   'N/A'   ,  'N/A       ',   'N/A'    ),
    'Ds':  ( 281.00        ,  110 ,  'N/A' ,   'N/A'   ,  'N/A       ',   'N/A'    ),
    'Rg':  ( 280.00        ,  111 ,  'N/A' ,   'N/A'   ,  'N/A       ',   'N/A'    ),
    'Cn':  ( 285.00        ,  112 ,  'N/A' ,   'N/A'   ,  'N/A       ',   'N/A'    )
}                                                         


#
# Return the mass and charge of the 
# chemical formular in string in tuple
#
def CrackFormular(chemformular):
    MassExpr = ''
    ChargeExpr = ''
    Component = {}
    i = 0
    # Parse the chemical formular
    while i < len(chemformular):
	  alpha = chemformular[i]
	  if alpha == '(':
	     MassExpr += '+('  
	     ChargeExpr += '+('
	     i += 1
	  elif alpha == ')':
	     MassExpr += ')'  
	     ChargeExpr += ')'
	     i += 1	      
	  # Wether it is an element   
	  elif alpha.isalpha():
	     if i == len(chemformular)-1:
	        if AtomList.has_key(alpha):
		   MassExpr += '+' + str(AtomList[alpha][IMASS])
		   ChargeExpr += '+' + str(AtomList[alpha][ICHARGE])
		   Component[alpha] = AtomList[alpha]
		   i +=1
		else:
		   return (NOELEMENT, alpha, {})
   	     else:
                em = chemformular[i:i+2]
                if AtomList.has_key(em):
                   d = 2
                else:
                   em = chemformular[i:i+1]
                   if AtomList.has_key(em):
                      d = 1
                   else:
	  	      return (NOELEMENT, em, {})
		MassExpr += '+' + str(AtomList[em][IMASS])
		ChargeExpr += '+' + str(AtomList[em][ICHARGE])
		Component[em] = AtomList[em]
	   	i += d
	  # Get the coefficients	
          elif alpha.isdigit():	     
 	     pdigit = 0
	     while ((i+pdigit < len(chemformular)) and (chemformular[i+pdigit] in '0123456789.')): pdigit += 1
	     if pdigit == 0:
	        MassExpr += '*1.00'
	        ChargeExpr += '*1.00'
  	     else:
	        MassExpr += '*' + chemformular[i:i+pdigit]
	        ChargeExpr += '*' + chemformular[i:i+pdigit]
	        i += pdigit   
	  else:
	     return (NOELEMENT, alpha, {})
    try:
        mass = eval(MassExpr)	           
        charge = eval(ChargeExpr)
    except:
        return (INVALIDFORMULAR, 0.00, {})
    
    return (mass, charge, Component)

